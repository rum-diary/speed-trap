/* This Source Code Form is subject to the terms of the Mozilla Public
*  License, v. 2.0. If a copy of the MPL was not distributed with this file,
*  You can obtain one at http://mozilla.org/MPL/2.0/.  */
!function(a,b){"use strict";"function"==typeof define&&define.amd?define([],b):"object"==typeof exports?module.exports=b():a.SpeedTrap=b()}(this,function(){"use strict";function a(a){if(Object.create)return Object.create(a);var b=function(){};return b.prototype=a,new b}function b(){return(new Date).getTime()}function c(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"===a?b:3&b|8;return c.toString(16)})}var d,e={init:function(d){d=d||{},this.navigationTiming=a(h),this.navigationTiming.init(d),this.baseTime=this.navigationTiming.get().navigationStart||b(),this.timers=a(i),this.timers.init({baseTime:this.baseTime}),this.events=a(j),this.events.init({baseTime:this.baseTime}),this.uuid=c(),this.tags=d.tags||[];try{this.returning=!!localStorage.getItem("_st"),localStorage.setItem("_st","1")}catch(e){}},getLoad:function(){var a;try{a=sessionStorage.getItem("_puuid"),sessionStorage.removeItem("_puuid")}catch(b){}return{uuid:this.uuid,puuid:a,navigationTiming:this.navigationTiming.diff(),referrer:document.referrer||"",tags:this.tags,returning:this.returning,screen:{width:window.screen.width,height:window.screen.height}}},getUnload:function(){try{sessionStorage.setItem("_puuid",this.uuid)}catch(a){}return{uuid:this.uuid,duration:b()-this.baseTime,timers:this.timers.get(),events:this.events.get()}}},f={navigationStart:void 0,unloadEventStart:void 0,unloadEventEnd:void 0,redirectStart:void 0,redirectEnd:void 0,fetchStart:void 0,domainLookupStart:void 0,domainLookupEnd:void 0,connectStart:void 0,connectEnd:void 0,secureConnectionStart:void 0,requestStart:void 0,responseStart:void 0,responseEnd:void 0,domLoading:void 0,domInteractive:void 0,domContentLoadedEventStart:void 0,domContentLoadedEventEnd:void 0,domComplete:void 0,loadEventStart:void 0,loadEventEnd:void 0};try{d=window.performance.timing}catch(g){d=a(f)}var h={init:function(a){a=a||{},this.navigationTiming=a.navigationTiming||d,this.baseTime=this.navigationTiming.navigationStart||b()},get:function(){return this.navigationTiming},diff:function(){var a={},b=this.baseTime;for(var c in f)a[c]=this.navigationTiming[c]?this.navigationTiming[c]-b:null;return a}},i={init:function(a){this.completed={},this.running={},this.baseTime=a.baseTime},start:function(a){var c=b();if(this.running[a])throw new Error(a+" timer already started");this.running[a]=c},stop:function(a){var c=b();if(!this.running[a])throw new Error(a+" timer not started");this.completed[a]||(this.completed[a]=[]);var d=this.running[a];this.completed[a].push({start:d-this.baseTime,stop:c-this.baseTime,elapsed:c-d}),this.running[a]=null,delete this.running[a]},get:function(a){return a?this.completed[a]:this.completed},clear:function(){this.completed={},this.running={}}},j={init:function(a){this.events=[],this.baseTime=a.baseTime},capture:function(a){this.events.push({type:a,offset:b()-this.baseTime})},get:function(){return this.events},clear:function(){this.events=[]}};return a(e)});